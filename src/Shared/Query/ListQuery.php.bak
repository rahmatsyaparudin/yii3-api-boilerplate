<?php

declare(strict_types=1);

namespace App\Shared\Query;

use App\Domain\Shared\Query\Pagination;
use App\Domain\Shared\Query\SortOrder;

/**
 * Generic List Query
 * 
 * Digunakan untuk semua domain query operations
 * Menggantikan domain-specific ListQuery classes
 */
final readonly class ListQuery
{
    public function __construct(
        public readonly ?array $filter = null,
        public readonly ?Pagination $pagination = null,
        public readonly ?SortOrder $sortOrder = null
    ) {}

    /**
     * Create with pagination
     */
    public static function withPagination(
        int $page = 1,
        int $limit = 20,
        ?array $filter = null,
        ?SortOrder $sortOrder = null
    ): self {
        return new self(
            filter: $filter,
            pagination: new \App\Domain\Shared\Query\Pagination(page: $page, limit: $limit),
            sortOrder: $sortOrder
        );
    }

    /**
     * Create with sorting
     */
    public static function withSorting(
        string $field,
        string $direction = SortOrder::ASC,
        ?array $filter = null,
        ?Pagination $pagination = null
    ): self {
        return new self(
            filter: $filter,
            pagination: $pagination,
            sortOrder: new \App\Domain\Shared\Query\SortOrder(field: $field, direction: $direction)
        );
    }

    /**
     * Create with filter
     */
    public static function withFilter(
        array $filter,
        ?Pagination $pagination = null,
        ?SortOrder $sortOrder = null
    ): self {
        return new self(
            filter: $filter,
            pagination: $pagination,
            sortOrder: $sortOrder
        );
    }

    /**
     * Create from array parameters
     */
    public static function fromArray(array $params): self
    {
        $pagination = null;
        if (isset($params['page']) || isset($params['page_size'])) {
            $pagination = new \App\Domain\Shared\Query\Pagination(
                page: $params['page'] ?? 1,
                limit: $params['page_size'] ?? 20
            );
        }

        $sortOrder = null;
        if (isset($params['sort'])) {
            $sortOrder = new \App\Domain\Shared\Query\SortOrder(
                field: $params['sort']['by'] ?? 'name',
                direction: $params['sort']['dir'] ?? SortOrder::ASC
            );
        }

        return new self(
            filter: $params['filter'] ?? null,
            pagination: $pagination,
            sortOrder: $sortOrder
        );
    }
}
