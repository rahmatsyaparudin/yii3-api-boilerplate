<?php

declare(strict_types=1);

namespace App\Shared\Query;

/**
 * Generic List Result
 * 
 * Digunakan untuk semua domain query results
 * Menggantikan domain-specific ListResult classes
 */
final readonly class ListResult
{
    /** @param mixed[] $items */
    public function __construct(
        public readonly array $items,
        public readonly int $total,
        public readonly int $page,
        public readonly int $limit
    ) {}

    /**
     * Get items
     * 
     * @return mixed[]
     */
    public function getItems(): array
    {
        return $this->items;
    }

    /**
     * Get total count
     */
    public function getTotal(): int
    {
        return $this->total;
    }

    /**
     * Get current page
     */
    public function getPage(): int
    {
        return $this->page;
    }

    /**
     * Get page size
     */
    public function getLimit(): int
    {
        return $this->limit;
    }

    /**
     * Get total pages
     */
    public function getTotalPages(): int
    {
        return (int) ceil($this->total / $this->limit);
    }

    /**
     * Check if has next page
     */
    public function hasNextPage(): bool
    {
        return $this->page < $this->getTotalPages();
    }

    /**
     * Check if has previous page
     */
    public function hasPreviousPage(): bool
    {
        return $this->page > 1;
    }

    /**
     * Get pagination metadata
     */
    public function getPaginationMeta(): array
    {
        return [
            'page' => $this->page,
            'page_size' => $this->limit,
            'total' => $this->total,
            'total_pages' => $this->getTotalPages(),
            'has_next' => $this->hasNextPage(),
            'has_previous' => $this->hasPreviousPage(),
        ];
    }

    /**
     * Create from array data
     */
    public static function fromArray(array $data): self
    {
        return new self(
            items: $data['items'] ?? [],
            total: $data['total'] ?? 0,
            page: $data['page'] ?? 1,
            limit: $data['limit'] ?? 20
        );
    }

    /**
     * Convert to array
     */
    public function toArray(): array
    {
        return [
            'items' => $this->items,
            'pagination' => $this->getPaginationMeta(),
        ];
    }
}
